import { AGICore } from "./ai/agi/core";
import { monitor } from "./ai/agi/monitor";
import { DistributedNode } from "./ai/agi/distributedNode";

export class Orchestrator {
  private core: AGICore;
  private distributedNode: DistributedNode;

  constructor() {
    this.core = new AGICore();
    this.distributedNode = new DistributedNode();
  }

  /**
   * Ekzekuton njÃ« input duke pÃ«rdorur njÃ« qasje hibride dhe tÃ« avancuar.
   * @param input Hyrja pÃ«r t'u pÃ«rpunuar
   * @returns NjÃ« premtim me rezultatin e pÃ«rpunimit
   */
  async execute(input: string): Promise<string> {
    monitor.log(`ğŸ¯ Orchestrator pranoi input: "${input}"`, "info");

    try {
      // PÃ«rpunim i avancuar i hyrjes
      const enrichedInput = this.enrichInput(input);
      monitor.log(`ğŸ” Hyrja e pasuruar: "${enrichedInput}"`, "debug");

      // ShpÃ«rndarje nÃ« njÃ« nyje tÃ« decentralizuar
      const distributedResult = await this.distributedNode.process(enrichedInput);
      monitor.log(`ğŸŒ Rezultati nga nyja e decentralizuar: "${distributedResult}"`, "debug");

      // Ekzekutim i bÃ«rthamÃ«s AGI
      const coreOutput = await this.core.run(distributedResult);
      monitor.log(`âœ… PÃ«rgjigje nga AGICore: "${coreOutput}"`, "info");

      // PÃ«rpunim i daljes pÃ«r njÃ« qasje hibride
      const finalOutput = this.processOutput(coreOutput);
      monitor.log(`ğŸ”„ Dalja e pÃ«rpunuar: "${finalOutput}"`, "debug");

      return finalOutput;
    } catch (error: any) {
      monitor.log(`âŒ Gabim gjatÃ« ekzekutimit: ${error.message}`, "error");
      return "Gabim gjatÃ« pÃ«rpunimit tÃ« komandÃ«s";
    }
  }

  /**
   * Pasuron hyrjen pÃ«r tÃ« pÃ«rfshirÃ« kontekst tÃ« avancuar.
   * @param input Hyrja origjinale
   * @returns Hyrja e pasuruar
   */
  private enrichInput(input: string): string {
    // Shto logjikÃ« pÃ«r pasurimin e hyrjes (p.sh., metadata, kontekst)
    return `[Pasuruar]: ${input}`;
  }

  /**
   * PÃ«rpunon daljen pÃ«r tÃ« pÃ«rfshirÃ« njÃ« qasje hibride.
   * @param output Dalja origjinale
   * @returns Dalja e pÃ«rpunuar
   */
  private processOutput(output: string): string {
    // Shto logjikÃ« pÃ«r pÃ«rpunimin e daljes (p.sh., formatim, transformim)
    return `[Hibride]: ${output}`;
  }
}

export const orchestrator = new Orchestrator();