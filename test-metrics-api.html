<!DOCTYPE html>
<html>
<head>
    <title>Test Metrics API</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .metrics { background: #f5f5f5; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .loading { color: #666; }
        .error { color: red; }
        .metric { margin: 10px 0; }
        .value { font-weight: bold; color: #0066cc; }
    </style>
</head>
<body>
    <h1>üß† EuroWeb AGI - Live Metrics Test</h1>
    
    <div id="status" class="loading">Loading metrics...</div>
    
    <div id="metrics" class="metrics" style="display:none;">
        <h3>System Metrics</h3>
        <div class="metric">CPU Usage: <span id="cpu" class="value">--</span>%</div>
        <div class="metric">GPU Usage: <span id="gpu" class="value">--</span>%</div>
        <div class="metric">Memory Used: <span id="memory" class="value">--</span> GB</div>
        <div class="metric">Memory Total: <span id="memTotal" class="value">--</span> GB</div>
        <div class="metric">Load Average: <span id="load" class="value">--</span></div>
        <div class="metric">Uptime: <span id="uptime" class="value">--</span></div>
        <div class="metric">Last Update: <span id="timestamp" class="value">--</span></div>
    </div>

    <button onclick="fetchMetrics()">üîÑ Refresh Metrics</button>
    <button onclick="startAutoRefresh()">‚ñ∂Ô∏è Start Auto Refresh (2s)</button>
    <button onclick="stopAutoRefresh()">‚èπÔ∏è Stop Auto Refresh</button>

    <script>
        let autoRefreshInterval = null;

        async function fetchMetrics() {
            try {
                document.getElementById('status').textContent = 'Fetching...';
                
                const response = await fetch('/api/metrics/live');
                const data = await response.json();
                
                if (response.ok) {
                    // Update UI
                    document.getElementById('cpu').textContent = data.cpu || 'N/A';
                    document.getElementById('gpu').textContent = data.gpu || 'N/A';
                    document.getElementById('memory').textContent = (data.memory?.used || 0).toFixed(2);
                    document.getElementById('memTotal').textContent = (data.memory?.total || 0).toFixed(2);
                    document.getElementById('load').textContent = data.loadAverage?.[0]?.toFixed(2) || 'N/A';
                    document.getElementById('uptime').textContent = Math.floor((data.uptime || 0) / 3600) + 'h';
                    document.getElementById('timestamp').textContent = new Date(data.timestamp).toLocaleTimeString();
                    
                    document.getElementById('status').textContent = '‚úÖ Connected';
                    document.getElementById('metrics').style.display = 'block';
                } else {
                    throw new Error(data.error || 'Failed to fetch');
                }
            } catch (error) {
                document.getElementById('status').innerHTML = `<span class="error">‚ùå Error: ${error.message}</span>`;
                console.error('Metrics fetch error:', error);
            }
        }

        function startAutoRefresh() {
            if (autoRefreshInterval) return;
            fetchMetrics(); // Initial fetch
            autoRefreshInterval = setInterval(fetchMetrics, 2000);
            document.getElementById('status').textContent += ' (Auto-refreshing every 2s)';
        }

        function stopAutoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
                document.getElementById('status').textContent = document.getElementById('status').textContent.replace(' (Auto-refreshing every 2s)', '');
            }
        }

        // Auto-start on page load
        window.onload = () => {
            setTimeout(fetchMetrics, 500);
        };
    </script>
</body>
</html>
